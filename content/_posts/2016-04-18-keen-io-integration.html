---
layout: post
title:  "Keen.io integration"
date:   2016-07-18 12:31:11
categories: jekyll ci iot
---

<h1>Was es nicht alles giebt ..</h1>

<div id="chart"></div>


<script>

$( document ).ready(function() {
	   

var client = new Keen({
    projectId: "{{ site.keen_projectId }}",
    readKey: "{{ site.keen_api_readKey }}"
});

Keen.ready(function(){
    var el = document.getElementById("chart");
    var query = new Keen.Query("average", {
        eventCollection: "build",
        filters: [
        {
            "operator": "eq",
            "property_name": "project",
            "property_value": "jekyll-site"
        }
    ],
        groupBy: [
        "cisystem"
    ],
        targetProperty: "duration",
        timeframe: "this_14_days",
        timezone: "UTC"
      });
    var chart = new Keen.Dataviz()
        .el(el)
        .chartType('bar')
        .height(400)
        .prepare();

    client.run(query, function(err, res){
       chart
           .parseRequest(this)
           .call(function(){
               var ds, df, line;
               ds = new google.visualization.arrayToDataTable(this.data());
               
               // Create and apply a formatter
               df = new google.visualization.DateFormat({
                   formatType: 'long', 
                   timeZone: -4
               });
               df.format(ds, 0);

               line = new google.visualization.BarChart(this.el());
               line.draw(ds);
           });
    });
});
});
</script>
